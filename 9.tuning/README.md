# ðŸŽ¯ Tuning

ì¿¼ë¦¬ íŠœë‹ì€ ë³‘ëª© í˜„ìƒì„ í•´ê²°í•˜ë¯€ë¡œ ì„±ëŠ¥ ê°œì„ ì— í° ë„ì›€ì„ ì¤€ë‹¤.  
Java, Python ì²˜ëŸ¼ Application ê³„ì¸µì—ì„œë„ í•´ê²°í•  ë¶€ë¶„ì´ ìžˆì§€ë§Œ Database I/O ì˜ ë³‘ëª© í˜„ìƒì„ í•´ê²°í•˜ëŠ” ì¿¼ë¦¬ íŠœë‹ì„ ìˆ˜í–‰í•´ë³¸ë‹¤.  

ìƒí™©ì— ë”°ë¼ ì¿¼ë¦¬ íŠœë‹ì´ ë‹¬ë¼ì§€ë¯€ë¡œ ìƒí™©ì„ ì„¤ì •í•˜ê³  ì–´ë–¤ì‹ìœ¼ë¡œ ê°œì„ í–ˆëŠ”ì§€ ì‚´íŽ´ë³¸ë‹¤.  

# ðŸŽ¯ ì‹œë‚˜ë¦¬ì˜¤

ê³µìž¥ì—ëŠ” ì—¬ëŸ¬ëŒ€ì˜ ì„¤ë¹„ê°€ ìžˆê³  ê° ì„¤ë¹„ë§ˆë‹¤ ë°œìƒí•˜ëŠ” ë°ì´í„°ë“¤ì„ 1ë¶„ ì£¼ê¸°ë¡œ 24ì‹œê°„ ë‚´ë‚´ ìˆ˜ì§‘í•˜ê³  ìžˆë‹¤.  
ë ˆì½”ë“œëŠ” `UPDATE`ì™€ `DELETE`ëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ” ë¡œê·¸ì„± ë°ì´í„°ì´ë‹¤. í•´ë‹¹ ë°ì´í„°ë“¤ì„ ë¶„ì„í•˜ê³  ê°€ê³µí•˜ì—¬ ìœ ì˜ë¯¸í•œ ê²°ê³¼ë¥¼ ë„ì¶œí•´ë‚¸ë‹¤.  

ì„¤ë¹„ 1ëŒ€ë‹¹ ìˆ˜ì§‘í•˜ëŠ” ë°ì´í„°ëŠ” `1,440(24ì‹œê°„ * 60ë¶„)`ê°œì´ë‹¤.  
ì„¤ë¹„ 1ëŒ€ë‹¹ 1ë…„ì— 525,600(`365 * 1,440 = 525,600`) ë ˆì½”ë“œë©´ ë§Žì§€ ì•Šì€ ë°ì´í„°ì§€ë§Œ, ìˆ˜ì§‘í•˜ëŠ” ë°ì´í„°ì˜ ì¢…ë¥˜ê°€ 1ê°œê°€ ì•„ë‹ˆë‹¤.  

ì¦‰ `N(ì„¤ë¹„ìˆ˜) * 1,440(1ë¶„ì£¼ê¸° 24ì‹œê°„) * M(ë°ì´í„° ì¢…ë¥˜)` ê°€ í•˜ë£¨ë™ì•ˆ ìŒ“ì¼ ì´ ë ˆì½”ë“œ ìˆ˜ì´ë‹¤.  
íŠ¹ì • ì„¤ë¹„ì— ëŒ€í•œ ê¸°ê°„ë³„ ë°ì´í„°ë“¤ì„ ì¡°íšŒí•˜ëŠ” ê²ƒì— ì´ˆì ì„ ë§žì¶˜ë‹¤.  

### âœ… Ready

ìƒˆë¡œ ì„¤ê³„í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ê¸°ì¡´ì— êµ¬ì¶•ë˜ì–´ ìžˆëŠ” ì‹œìŠ¤í…œì„ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ë‹¤.  
íŠ¹ì§•ìœ¼ë¡œëŠ” ì‹œí€€ìŠ¤ í‚¤ê°€ ì—†ìœ¼ë©° ë³µí•©í‚¤ë§Œ ì¡´ìž¬í•œë‹¤.  
`PRDDATE` ì»¬ëŸ¼ì€ `yyyy.MM.dd` í˜•ì‹ìœ¼ë¡œ ë‚ ì§œ ì»¬ëŸ¼ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ ì‹¤ì œ `VARCHAR(10)` íƒ€ìž…ì´ë‹¤.  
ìƒ˜í”Œ ë°ì´í„°ëŠ” ì‹¤ì œ ë°ì´í„°ë“¤ ì¤‘ ì¼ë¶€ë¥¼ ê°€ì ¸ì™”ìœ¼ë©° `MsSQL` -> `MySQL` ë¡œ ë³€ê²½í•´ ì§„í–‰í•œë‹¤.  

- DDL

```sql
CREATE TABLE `TB_TEMP1` (
  `DEVICECODE` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `DEVICESUBCODE` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `PRDDATE` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL,
  `PRDTIME` datetime NOT NULL,
  `PV_VALUE` float DEFAULT NULL,
  `UNITCODE` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  `MCCODE` varchar(20) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL,
  PRIMARY KEY (`DEVICECODE`,`DEVICESUBCODE`,`PRDDATE`,`PRDTIME`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;
```

ë¹„êµë¥¼ ìœ„í•´ 2ê°œì˜ í…Œì´ë¸”ì„ ì–¸ê¸‰í•˜ë©° ì§„í–‰í•œë‹¤.  

- `TB_TEMP1`: ì¿¼ë¦¬ íŠœë‹ â­•ï¸ 
- `TB_TEMP2`: ì¿¼ë¦¬ íŠœë‹ âŒ

ì£¼ìš” ì»¬ëŸ¼ ì†Œê°œ

- DEVICESUBCODE: ë°ì´í„° ì½”ë“œ
- PRDDATE: yyyy.MM.dd ë‚ ì§œí˜•ì‹ì˜ ë¬¸ìžì—´
- PRDTIME: ì‹¤ì œ ë°ì´í„°ê°€ ìˆ˜ì§‘ëœ ì£¼ê¸° (1ë¶„ ë‹¨ìœ„)
- PV_VALUE: ë°ì´í„° ê°’
- UNITCODE: ë‹¨ìœ„
- MCCODE: ì„¤ë¹„ ì½”ë“œ

# ðŸŽ¯ Tuning

`TB_TEMP1` ê³¼ `TB_TEMP2` ëŠ” ì´ë¦„ë§Œ ë‹¤ë¥¼ë¿ ê°™ì€ í…Œì´ë¸”ì´ë©° ë ˆì½”ë“œ ìˆ˜ ë˜í•œ ê°™ë‹¤.  

```sql
mysql> SELECT COUNT(*) FROM TB_TEMP1;
+----------+
| COUNT(*) |
+----------+
|  1971231 |
+----------+
1 row in set (0.56 sec)

mysql> SELECT COUNT(*) FROM TB_TEMP2;
+----------+
| COUNT(*) |
+----------+
|  1971231 |
+----------+
1 row in set (0.45 sec)
```

íŠ¹ì • ê¸°ê°„ë™ì•ˆ ì¡°íšŒí•˜ëŠ” ì¿¼ë¦¬ì˜ ì‹¤í–‰ ê³„íšì„ ë³´ë©´, `í…Œì´ë¸” í’€ ìŠ¤ìº”`ìœ¼ë¡œ ì²˜ë¦¬ë¨ì„ ì•Œ ìˆ˜ ìžˆë‹¤.  

```sql
mysql> EXPLAIN SELECT * FROM TB_TEMP1 WHERE PRDTIME >= '2024.05.01' AND PRDTIME < '2024.06.01';
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
|  1 | SIMPLE      | TB_TEMP1 | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1949291 |    11.11 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
1 row in set, 3 warnings (0.01 sec)

mysql> EXPLAIN SELECT * FROM TB_TEMP2 WHERE PRDTIME >= '2024.05.01' AND PRDTIME < '2024.06.01';
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
|  1 | SIMPLE      | TB_TEMP2 | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1901865 |    11.11 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
1 row in set, 3 warnings (0.00 sec)
```

íŠœë‹ì„ í•˜ê¸° ì•žì„œ í•´ë‹¹ í…Œì´ë¸”ì´ ì–´ë–¤ ì—­í• ë¡œ ë§Žì´ ì‚¬ìš©ë˜ëŠ”ì§€, ì–´ë–¤ ì»¬ëŸ¼ë“¤ì´ ê¸°ì¤€ì´ ë˜ì–´ì•¼í•˜ëŠ”ì§€ ì•Œì•„ì•¼ í•œë‹¤.  
í•œ ë²ˆ ì ìž¬ëœ ë ˆì½”ë“œì— ëŒ€í•œ ê°±ì‹ (`UPDATE`, `DELETE`)ì´ ê±°ì˜ ì—†ê³  ì‹œê°„ ë²”ìœ„ì— ëŒ€í•œ ì¡°íšŒê°€ ë§Žì€ ìƒí™©ì´ë‹¤.  
 
ê¸°ê°„ì„ ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí•˜ê¸° ìœ„í•´ `PRDDATE` ì»¬ëŸ¼ê³¼ `PRDTIME` ì»¬ëŸ¼ì´ ìžˆë‹¤.  
`PRDDATE` ëŠ” ë¬¸ìžì—´ íƒ€ìž…ì´ë©° `yyyy-MM-dd` í˜•ì‹ì„ ê°€ì§€ê³  ìžˆë‹¤. ë¬¸ìžì—´ì˜ í˜•ì‹ì„ ë‚ ì§œì™€ ë™ì¼í•˜ê²Œ ê°€ì ¸ê°€ë”ë¼ë„ ë‚ ì§œíƒ€ìž…(`date`,`datetime`)ì€ ì •ìˆ˜í˜•ì¸ `timestamp` ê°’ìœ¼ë¡œ ì €ìž¥ë¼ì„œ ì˜µí‹°ë§ˆì´ì €ê°€ ë” ìœ ë¦¬í•˜ê²Œ ê°€ì ¸ê°ˆ ìˆ˜ ìžˆë‹¤.  

ê¸°ê°„ì„ ì¡°íšŒí•˜ê¸° ìœ„í•´ `PRDTIME` ì»¬ëŸ¼ì„ ì¸ë±ìŠ¤ë¡œ ì¶”ê°€í•˜ê³  ê·¸ì™¸ì— ì„¤ë¹„ë¥¼ ì‹ë³„í•  ì„¤ë¹„ ì½”ë“œì¸ `MCCODE` ë„ ì¶”ê°€í•´ì¤€ë‹¤.  
`DEVICESUBCODE` ëŠ” í•´ë‹¹ ë ˆì½”ë“œê°€ ì–´ë–¤ ë°ì´í„°ë¥¼ ì˜ë¯¸í•˜ëŠ”ì§€ ë‚˜íƒ€ë‚´ëŠ”ë°, ì§€í‘œì™€ ê´€ë ¨ëœ í…Œì´ë¸”ê³¼ ì¡°ì¸í•  ê²ƒì´ë¯€ë¡œ `PRDTIME`, `MCCODE`, `DEVICESUBCODE` ê°€ ì¤‘ìš”í•˜ë‹¤ê³  ë³¼ ìˆ˜ ìžˆë‹¤.  

ê¸°ìˆ˜ì„±ì´ ë†’ì€ `PRDTIME`ê³¼ ê° ì„¤ë¹„ë¥¼ êµ¬ë¶„í•˜ê¸° ìœ„í•´ `MCCODE` ë¥¼ ì¸ë±ìŠ¤ì— í¬í•¨ì‹œì¼œì•¼ í•œë‹¤.  
ì´ì™¸ì— í•„ìš”í•œ ì»¬ëŸ¼ë“¤ì€ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìžˆë„ë¡ ì¶”ê°€í•œë‹¤.  

# ðŸŽ¯ 1ì°¨ íŠœë‹ 

`TB_TEMP1` í…Œì´ë¸”ì— `PRDTIME`, `MCCODE` ë¡œ ì¸ë±ìŠ¤ë¥¼ ì„¤ì •í•˜ê³  ì‹¤í–‰ê³„íšì„ ë‹¤ì‹œ ì‚´íŽ´ë³´ìž.  

```sql
mysql> CREATE INDEX idx_tb_temp1
    -> ON TB_TEMP1 (PRDTIME, MCCODE);
Query OK, 0 rows affected (4.02 sec)
Records: 0  Duplicates: 0  Warnings: 0
```

```sql
mysql> EXPLAIN SELECT * FROM TB_TEMP1 WHERE PRDTIME >= '2024.05.01' AND PRDTIME < '2024.06.01';
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
|  1 | SIMPLE      | TB_TEMP1 | NULL       | ALL  | idx_tb_temp1  | NULL | NULL    | NULL | 1949291 |    50.00 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
1 row in set, 3 warnings (0.00 sec)

mysql> EXPLAIN SELECT * FROM TB_TEMP2 WHERE PRDTIME >= '2024.05.01' AND PRDTIME < '2024.06.01';
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
| id | select_type | table    | partitions | type | possible_keys | key  | key_len | ref  | rows    | filtered | Extra       |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
|  1 | SIMPLE      | TB_TEMP2 | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 1901865 |    11.11 | Using where |
+----+-------------+----------+------------+------+---------------+------+---------+------+---------+----------+-------------+
1 row in set, 3 warnings (0.00 sec)
```

`TB_TEMP1` ì— ì¸ë±ìŠ¤ë¥¼ ì¶”ê°€í–ˆì§€ë§Œ ìž˜ í™œìš©í•  ìˆ˜ ì—†ì—ˆë‹¤.  
ì¸ë±ìŠ¤ë¥¼ í™œìš©í•  ìˆ˜ ìžˆë„ë¡ ìˆ˜ì •í•œë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì¿¼ë¦¬ëŠ” í•´ë‹¹ë  ê²ƒì´ë‹¤.  

```sql
mysql> EXPLAIN SELECT PRDTIME, MCCODE FROM TB_TEMP1 WHERE PRDTIME >= '2024.05.01' AND PRDTIME < '2024.06.01';
+----+-------------+----------+------------+-------+---------------+--------------+---------+------+--------+----------+--------------------------+
| id | select_type | table    | partitions | type  | possible_keys | key          | key_len | ref  | rows   | filtered | Extra                    |
+----+-------------+----------+------------+-------+---------------+--------------+---------+------+--------+----------+--------------------------+
|  1 | SIMPLE      | TB_TEMP1 | NULL       | range | idx_tb_temp1  | idx_tb_temp1 | 5       | NULL | 974645 |   100.00 | Using where; Using index |
+----+-------------+----------+------------+-------+---------------+--------------+---------+------+--------+----------+--------------------------+
1 row in set, 3 warnings (0.01 sec)

mysql> EXPLAIN SELECT PRDTIME FROM TB_TEMP1 WHERE PRDTIME >= '2024.05.01' AND PRDTIME < '2024.06.01';
+----+-------------+----------+------------+-------+----------------------+---------+---------+------+--------+----------+----------------------------------------+
| id | select_type | table    | partitions | type  | possible_keys        | key     | key_len | ref  | rows   | filtered | Extra                                  |
+----+-------------+----------+------------+-------+----------------------+---------+---------+------+--------+----------+----------------------------------------+
|  1 | SIMPLE      | TB_TEMP1 | NULL       | range | PRIMARY,idx_tb_temp1 | PRIMARY | 211     | NULL | 216544 |   100.00 | Using where; Using index for skip scan |
+----+-------------+----------+------------+-------+----------------------+---------+---------+------+--------+----------+----------------------------------------+
1 row in set, 3 warnings (0.00 sec)
```

ì²« ë²ˆì§¸ëŠ” ì»¤ë²„ë§ ì¸ë±ìŠ¤ë„ ì„±ê³µì ì´ë©°  
ë‘ ë²ˆì§¸ ì¿¼ë¦¬ëŠ” ë³µí•© ì¸ë±ìŠ¤ì—ì„œ ëˆ„ë½ëœ ì»¬ëŸ¼ì´ ìžˆì–´ë„ ì˜µí‹°ë§ˆì´ì €(MySQL 8.0ì´ìƒ)ê°€ ì¸ë±ìŠ¤ ìŠ¤í‚µ ìŠ¤ìº”ì„ ì‚¬ìš©í–ˆìŒì„ ì•Œ ìˆ˜ ìžˆë‹¤.  
í•˜ì§€ë§Œ `PRIMARY`ê°€ í¬í•¨ë˜ì—ˆëŠ”ë° ì´ëŠ” ì˜µí‹°ë§ˆì´ì €ê°€ ë³µí•©í‚¤ì—ì„œ í•„ìš”í•œ ê°’ë§Œ ê±¸ëŸ¬ë„ ë¹ ë¥´ë‹¤ê³  íŒë‹¨í–ˆê¸° ë•Œë¬¸ì´ë‹¤. (ì¸ë±ìŠ¤ê°€ ì´ë¯¸ í´ëŸ¬ìŠ¤í„°ë§ë˜ì–´ ìžˆìœ¼ë‹ˆ)  

ë‘ ë²ˆì§¸ ì¿¼ë¦¬ì˜ ì‹¤í–‰ê³„íšë„ ì¶©ë¶„ížˆ ì¢‹ì§€ë§Œ ê°•ì œë¡œ ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ê²Œ í•  ìˆ˜ ìžˆë‹¤.  

```sql
mysql> EXPLAIN SELECT PRDTIME FROM TB_TEMP1 FORCE INDEX (idx_tb_temp1) WHERE PRDTIME >= '2024-05-01' AND PRDTIME < '2024-06-01';
+----+-------------+----------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
| id | select_type | table    | partitions | type  | possible_keys | key          | key_len | ref  | rows | filtered | Extra                    |
+----+-------------+----------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
|  1 | SIMPLE      | TB_TEMP1 | NULL       | range | idx_tb_temp1  | idx_tb_temp1 | 5       | NULL |    1 |   100.00 | Using where; Using index |
+----+-------------+----------+------------+-------+---------------+--------------+---------+------+------+----------+--------------------------+
1 row in set, 1 warning (0.02 sec)
```
