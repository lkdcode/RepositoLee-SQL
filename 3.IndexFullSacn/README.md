# ğŸ¯ ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”

ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì§€ë§Œ ì¸ë±ìŠ¤ì˜ ì²˜ìŒë¶€í„° ëê¹Œì§€ ëª¨ë‘ ì½ëŠ” ë°©ì‹ì„ ëœ»í•œë‹¤.  
ì¼ë°˜ì ìœ¼ë¡œ ì¸ë±ìŠ¤ì˜ í¬ê¸°ëŠ” í…Œì´ë¸”ì˜ í¬ê¸°ë³´ë‹¤ ì‘ìœ¼ë¯€ë¡œ ì§ì ‘ í…Œì´ë¸”ì„ ì²˜ìŒë¶€í„° ëê¹Œì§€ ì½ëŠ” ê²ƒë³´ë‹¤ ì¸ë±ìŠ¤ë§Œ ì½ëŠ” ê²ƒì´ íš¨ìœ¨ì ì´ë‹¤.  
ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì€ ì¸ë±ìŠ¤ ë ˆì¸ì§€ ìŠ¤ìº”ë³´ë‹¤ íš¨ìœ¨ì€ ë–¨ì–´ì§€ì§€ë§Œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ë¡œ ì²˜ë¦¬ê°€ ëœë‹¤ë©´ í…Œì´ë¸” í’€ ìŠ¤ìº”ë³´ë‹¤ ë” íš¨ìœ¨ì ì¸ ë””ìŠ¤í¬ I/O ë¡œ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.  

ì˜ˆë¥¼ ë“¤ì–´ ì•„ë˜ì™€ ê°™ì´ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ë³´ì.  

### âœ… Ready

ëŒ€ìš©ëŸ‰ì˜ ë°ì´í„°ê°€ í•„ìš”í•˜ë¯€ë¡œ ğŸ”— [Repository: test_db](https://github.com/datacharmer/test_db) ë¥¼ ì°¸ê³ í•˜ì—¬ ğŸ”— [0. data](../2.IndexRangeScan/0.data/) ë””ë ‰í† ë¦¬ì— í†µí•´ í•„ìš”í•œ ë°ì´í„°ë§Œ ëª¨ì•„ ë‘ì—ˆìŠµë‹ˆë‹¤. í•˜ë‚˜ì˜ MySQL ì„œë²„ì—ì„œ 2ê°œì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ êµ¬ì¶•í•˜ê³  í•˜ë‚˜ì˜ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” í…Œì´ë¸”ì„ íŠœë‹í•˜ê³  í•˜ë‚˜ëŠ” í•˜ì§€ ì•ŠëŠ” ê²ƒì´ ë¹„êµí•˜ë©´ì„œ í™•ì¸í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.  

# ğŸ¯ ëª©í‘œì— ì•ì„œ

ì‚¬ìš©í•  í…Œì´ë¸”ì€ ğŸ”— [employees](./0.data/employees.sql) ì´ë¯€ë¡œ ê°„ëµí•˜ê²Œ í…Œì´ë¸” êµ¬ì¡°ë¥¼ í™•ì¸í•˜ê¸° ë°”ëë‹ˆë‹¤.  

```sql
mysql> DESCRIBE employees;
+------------+---------------+------+-----+---------+-------+
| Field      | Type          | Null | Key | Default | Extra |
+------------+---------------+------+-----+---------+-------+
| emp_no     | int           | NO   | PRI | NULL    |       |
| birth_date | date          | NO   |     | NULL    |       |
| first_name | varchar(14)   | NO   |     | NULL    |       |
| last_name  | varchar(16)   | NO   |     | NULL    |       |
| gender     | enum('M','F') | NO   |     | NULL    |       |
| hire_date  | date          | NO   |     | NULL    |       |
+------------+---------------+------+-----+---------+-------+
6 rows in set (0.04 sec)
```

íŠœë‹í•œ í…Œì´ë¸”ê³¼ íŠœë‹í•˜ì§€ ì•ŠëŠ” í…Œì´ë¸”ì„ ë‘ë©´ ì§ì ‘ ë¹„êµí•˜ê¸° ìˆ˜ì›”í•´ì„œ 2ê°œì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ê³  ë˜‘ê°™ì€ ë°ì´í„°ë¥¼ ì¤€ë¹„í•©ë‹ˆë‹¤.  

```sql
mysql> CREATE DATABASE normal;
mysql> CREATE DATABASE tuning;
```

`normal` ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ë“¤ì€ íŠœë‹í•˜ì§€ ì•Šê³  `tuning` ë°ì´í„°ë² ì´ìŠ¤ì˜ í…Œì´ë¸”ë“¤ì€ íŠœë‹í•©ë‹ˆë‹¤.  

# ğŸ¯ ì‹¤í–‰ê³„íš  

`tuning.employees` ì— ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•´ì¤€ë‹¤. ì´ 3ê°œì˜ ì»¬ëŸ¼ì„ ê°€ì§€ê³  ìˆìœ¼ë©°, ìˆœì„œì— ì£¼ì˜í•œë‹¤.  

```sql
mysql> USE tuning;
mysql> CREATE INDEX ix_full ON employees(first_name, last_name, gender);
```

```sql
# í˜„ì¬ ìƒì„±ëœ ì¸ë±ìŠ¤ 
mysql> SHOW INDEX FROM employees;
+-----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| Table     | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment | Visible | Expression |
+-----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
| employees |          0 | PRIMARY  |            1 | emp_no      | A         |      299512 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| employees |          1 | ix_full  |            1 | first_name  | A         |        1314 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| employees |          1 | ix_full  |            2 | last_name   | A         |      276618 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
| employees |          1 | ix_full  |            3 | gender      | A         |      289357 |     NULL |   NULL |      | BTREE      |         |               | YES     | NULL       |
+-----------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
4 rows in set (0.01 sec)
```

`ix_full` ì¸ë±ìŠ¤ë¡œ ì²˜ë¦¬ë  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ëŠ” `first_name, last_name, gender` ìˆœì„œë¥¼ ì§€í‚¨ ì»¬ëŸ¼ì´ì–´ì•¼ í•œë‹¤.  
ë§Œì•½ ì¡°ê±´ì ˆì— `last_name` ì»¬ëŸ¼ì´ë‚˜ `gender` ì»¬ëŸ¼ìœ¼ë¡œ ì¡°íšŒí•˜ëŠ” ê²½ìš° ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ìœ¼ë¡œ ì²˜ë¦¬ëœë‹¤.  

```sql
# normal.employees (ì¸ë±ìŠ¤ ì—†ìŒ)
# tuning.employees (ì¸ë±ìŠ¤ ìˆìŒ)

# ì¸ë±ìŠ¤ ìœ ë¬´ì™€ ìƒê´€ì—†ì´ í•´ë‹¹ ì¿¼ë¦¬ëŠ” í…Œì´ë¸” í’€ ìŠ¤ìº”ìœ¼ë¡œ ë™ì‘í•œë‹¤.

mysql> EXPLAIN SELECT * FROM employees;
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+
|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299069 |   100.00 | NULL  |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+
1 row in set, 1 warning (0.00 sec)
```

ìœ„ì—ì„œ ì•Œ ìˆ˜ ìˆë“¯ì´ ì¸ë±ìŠ¤ì™€ ìƒê´€ì—†ì´ í…Œì´ë¸” í’€ ìŠ¤ìº”ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì¿¼ë¦¬ì´ë‹¤. í•˜ì§€ë§Œ `ix_full` ì¸ë±ìŠ¤ì— ìˆëŠ” ì»¬ëŸ¼ë§Œ ì¡°íšŒí•˜ê²Œ ëœë‹¤ë©´ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.  

```sql
# normal.employees (ì¸ë±ìŠ¤ ì—†ìŒ)
mysql> EXPLAIN SELECT first_name, last_name, gender FROM employees;
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+
|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299069 |   100.00 | NULL  |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+-------+
1 row in set, 1 warning (0.01 sec)
```

```sql
# tuning.employees (ì¸ë±ìŠ¤ ìˆìŒ)
mysql> EXPLAIN SELECT first_name, last_name, gender FROM employees;
+----+-------------+-----------+------------+-------+---------------+---------+---------+------+--------+----------+-------------+
| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref  | rows   | filtered | Extra       |
+----+-------------+-----------+------------+-------+---------------+---------+---------+------+--------+----------+-------------+
|  1 | SIMPLE      | employees | NULL       | index | NULL          | ix_full | 125     | NULL | 299512 |   100.00 | Using index |
+----+-------------+-----------+------------+-------+---------------+---------+---------+------+--------+----------+-------------+
1 row in set, 1 warning (0.01 sec)
```

`tpye=all` ì€ í…Œì´ë¸” í’€ ìŠ¤ìº”ì„ ëœ»í•˜ê³  `type=inex` ëŠ” ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì„ ì˜ë¯¸í•œë‹¤.
`ix_full` ì¸ë±ìŠ¤ëŠ” `first_name`, `last_name`, `gender` ë¡œ ì´ë£¨ì–´ì ¸ ìˆìœ¼ë¯€ë¡œ `tuning.employees` ì—ì„œëŠ” ì‚¬ìš©ì´ ê°€ëŠ¥í•œ ê²ƒì´ë‹¤.  

í•˜ì§€ë§Œ ì‹¤ì œ ì¿¼ë¦¬ ì²˜ë¦¬ ì†Œìš”ì‹œê°„ì€ í¬ê²Œ ë‹¤ë¥´ì§€ ì•Šë‹¤.  

```sql
# normal
mysql> SELECT first_name, last_name, gender FROM employees;
...
| Berhard        | Lenart           | M      |
| Patricia       | Breugel          | M      |
| Sachin         | Tsukuda          | M      |
+----------------+------------------+--------+
300024 rows in set (0.12 sec)
```

```sql
# tuning
mysql> SELECT first_name, last_name, gender FROM employees;
...
| Zvonko         | Zobel            | M      |
| Zvonko         | Zuberek          | F      |
+----------------+------------------+--------+
300024 rows in set (0.13 sec)
```

í…Œì´ë¸” í’€ ìŠ¤ìº”ì€ ìˆœì°¨ I/O ë¡œ ì½ëŠ”ë° ë°˜ë©´ ì¸ë±ìŠ¤ëŠ” ëœë¤ I/O ë¡œ ì½ê²Œ ëœë‹¤.  
í•˜ì§€ë§Œ ì»¤ë²„ë§ ì¸ë±ìŠ¤ê°€ ê°€ëŠ¥í•˜ë¯€ë¡œ ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì—ì„œ ëœë¤ I/O ê°€ ë°œìƒí•˜ì§€ ì•Šê³  ë¦¬í”„ ë…¸ë“œë¥¼ ìˆœì°¨ì ìœ¼ë¡œ íƒìƒ‰í•˜ê³  ì¿¼ë¦¬ê°€ ì¢…ë£Œë˜ë¯€ë¡œ ì„±ëŠ¥ì´ ë¹„ìŠ·í•˜ê²Œ ë‚˜ì˜¤ëŠ” ê²ƒì´ë‹¤.  
í˜„ì¬ ë ˆì½”ë“œ ìˆ˜ëŠ” ì•½ 30ë§Œê°œë¡œ ì´ë³´ë‹¤ ë” ë§ì€ ë ˆì½”ë“œ ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆëŠ” í…Œì´ë¸”ì´ë¼ë©´ ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì˜ ì„±ëŠ¥ì´ ë” íš¨ìœ¨ì ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.  
ì¼ë°˜ì ìœ¼ë¡œ ì¸ë±ìŠ¤ì˜ í¬ê¸°ëŠ” ë” ì‘ìœ¼ë¯€ë¡œ I/O ë¹„ìš©ì„ ì ˆê°í•  ìˆ˜ ìˆë‹¤.  
ë²„í¼ í’€ ë©”ëª¨ë¦¬ëŠ” ìì£¼ ì‚¬ìš©í•˜ëŠ” ì¸ë±ìŠ¤ ë° í…Œì´ë¸” í˜ì´ì§€ë¥¼ ìºì‹±í•˜ì—¬ ë””ìŠ¤í¬ I/O ë¥¼ ìµœì†Œí™”í•  ìˆ˜ ìˆëŠ”ë° ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì€ ë©”ëª¨ë¦¬ ë‚´ì—ì„œ ì²˜ë¦¬ë˜ëŠ” ê²½ìš°ê°€ ë§ì•„ ì„±ëŠ¥ì´ ë” ìš°ìˆ˜í•˜ë‹¤.  

ì½ê¸° ì†ìµë¶„ê¸°ì ì„ ì˜ ê³ ë ¤í•´ì•¼ê² ì§€ë§Œ ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì€ ì •ë ¬ì—ë„ ì˜ë¯¸ê°€ ìˆë‹¤.  
ì´ë¯¸ ì •ë ¬ë˜ì–´ ìˆëŠ” ì´ì ì„ í™œìš©í•œë‹¤ë©´ `ORDER BY` êµ¬ë¬¸ì—ì„œ í™•ì‹¤í•œ ì„±ëŠ¥ ì°¨ì´ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.  

```sql
# normal
# ì‹¤í–‰ ê³„íš

mysql> EXPLAIN SELECT first_name, last_name, gender FROM employees ORDER BY first_name, last_name;
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+
| id | select_type | table     | partitions | type | possible_keys | key  | key_len | ref  | rows   | filtered | Extra          |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+
|  1 | SIMPLE      | employees | NULL       | ALL  | NULL          | NULL | NULL    | NULL | 299069 |   100.00 | Using filesort |
+----+-------------+-----------+------------+------+---------------+------+---------+------+--------+----------+----------------+
1 row in set, 1 warning (0.02 sec)

# ì‹¤ì œ ê²°ê³¼

mysql> SELECT first_name, last_name, gender FROM employees ORDER BY first_name, last_name;
...
| Zvonko         | Zobel            | M      |
| Zvonko         | Zuberek          | F      |
+----------------+------------------+--------+
300024 rows in set (0.30 sec)
```

```sql
# tuning
# ì‹¤í–‰ ê³„íš

mysql> EXPLAIN SELECT first_name, last_name, gender FROM employees ORDER BY first_name, last_name;
+----+-------------+-----------+------------+-------+---------------+---------+---------+------+--------+----------+-------------+
| id | select_type | table     | partitions | type  | possible_keys | key     | key_len | ref  | rows   | filtered | Extra       |
+----+-------------+-----------+------------+-------+---------------+---------+---------+------+--------+----------+-------------+
|  1 | SIMPLE      | employees | NULL       | index | NULL          | ix_full | 125     | NULL | 299512 |   100.00 | Using index |
+----+-------------+-----------+------------+-------+---------------+---------+---------+------+--------+----------+-------------+
1 row in set, 1 warning (0.00 sec)

# ì‹¤ì œ ê²°ê³¼

mysql> SELECT first_name, last_name, gender FROM employees ORDER BY first_name, last_name;
...
| Zvonko         | Zobel            | M      |
| Zvonko         | Zuberek          | F      |
+----------------+------------------+--------+
300024 rows in set (0.08 sec)
```

ì¸ë±ìŠ¤ í’€ ìŠ¤ìº”ì€ í…Œì´ë¸” í’€ ìŠ¤ìº”ê³¼ ë‹¤ë¥´ê²Œ í•­ìƒ ì •ë ¬ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìœ„ì˜ ì¿¼ë¦¬ì—ì„œ í™•ì‹¤í•˜ê²Œ ì°¨ì´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.  